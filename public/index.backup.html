<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kick Leaderboard</title>
  <style>
    /* your existing styles here */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      overflow-x: hidden;
      overflow-y: auto;
    }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
      color: #ffffff;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      overflow-x: hidden;
      overflow-y: auto;
    }

    /* Navbar styles */
    .navbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 2000;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 70px;
    }

    .nav-container {
      display: flex;
      align-items: center;
      gap: 0;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      padding: 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .nav-tab {
      background: transparent;
      border: none;
      color: rgba(255, 255, 255, 0.7);
      padding: 12px 24px;
      border-radius: 10px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      min-width: 140px;
      text-align: center;
    }

    .nav-tab:hover {
      color: rgba(255, 255, 255, 0.9);
      background: rgba(255, 255, 255, 0.1);
    }

    .nav-tab.active {
      background: rgba(255, 255, 255, 0.2);
      color: #ffffff;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .nav-tab.active::before {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 50%;
      transform: translateX(-50%);
      width: 20px;
      height: 3px;
      background: linear-gradient(90deg, #3b82f6, #1d4ed8);
      border-radius: 2px;
    }

    /* Content sections */
    .content-section {
      display: none;
      width: 100%;
      padding-top: 35px;
    }

    .content-section.active {
      display: block;
    }

    /* Timer styles */
    .timer-container {
      position: fixed;
      top: 90px;
      right: 20px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      border-radius: 15px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 15px 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      min-width: 200px;
      text-align: center;
    }

    .timer-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: #e0e7ff;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .timer-display {
      font-size: 1.2rem;
      font-weight: 700;
      color: #ffffff;
      font-family: 'Courier New', monospace;
    }

    .timer-warning {
      color: #fbbf24;
      animation: pulse 2s infinite;
    }

    .timer-critical {
      color: #ef4444;
      animation: pulse 1s infinite;
    }

    .previous-leaderboard-btn {
      background: linear-gradient(45deg, #6b7280, #4b5563);
      border: none;
      border-radius: 8px;
      padding: 8px 16px;
      color: #ffffff;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.8rem;
      margin-top: 10px;
      width: 100%;
    }

    .previous-leaderboard-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 5px 15px rgba(107, 114, 128, 0.3);
      background: linear-gradient(45deg, #9ca3af, #6b7280);
    }

    /* Roll system styles */
    .roll-container {
      position: fixed;
      top: 90px;
      left: 20px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      border-radius: 15px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      min-width: 280px;
      max-width: 320px;
    }

    .roll-title {
      font-size: 1.1rem;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 15px;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .roll-timer {
      font-size: 1.3rem;
      font-weight: 700;
      color: #10b981;
      font-family: 'Courier New', monospace;
      text-align: center;
      margin-bottom: 15px;
      padding: 10px;
      background: rgba(16, 185, 129, 0.1);
      border-radius: 8px;
      border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .roll-winner {
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 10px;
    }

    .roll-winner-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: #3b82f6;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .roll-winner-name {
      font-size: 1.2rem;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 5px;
    }

    .roll-winner-prize {
      font-size: 1.1rem;
      font-weight: 600;
      color: #10b981;
    }

    .roll-hash {
      font-size: 0.7rem;
      color: #9ca3af;
      word-break: break-all;
      margin-top: 10px;
      padding: 8px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 4px;
    }

    /* Verification modal styles */
    .verification-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: rgba(59, 130, 246, 0.2);
      border: 1px solid rgba(59, 130, 246, 0.5);
      color: #3b82f6;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .verification-btn:hover {
      background: rgba(59, 130, 246, 0.3);
      transform: scale(1.1);
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
      z-index: 2000;
      display: none;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: rgba(30, 41, 59, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 30px;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .modal-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #ffffff;
    }

    .modal-close {
      background: none;
      border: none;
      color: #9ca3af;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 5px;
      border-radius: 5px;
      transition: all 0.3s ease;
    }

    .modal-close:hover {
      color: #ffffff;
      background: rgba(255, 255, 255, 0.1);
    }

    .verification-section {
      margin-bottom: 25px;
    }

    .section-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: #e0e7ff;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .verification-input {
      width: 100%;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      padding: 12px;
      color: #ffffff;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
      margin-bottom: 10px;
    }

    .verification-input:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
    }

    .verify-btn {
      background: linear-gradient(45deg, #3b82f6, #1d4ed8);
      border: none;
      border-radius: 8px;
      padding: 12px 24px;
      color: #ffffff;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 20px;
    }

    .verify-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
    }

    .verify-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .result-section {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: 8px;
      padding: 15px;
      margin-top: 15px;
    }

    .result-item {
      margin-bottom: 8px;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
    }

    .result-label {
      color: #10b981;
      font-weight: 600;
    }

    .result-value {
      color: #ffffff;
      word-break: break-all;
    }

    .current-seed-section {
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }

    .seed-display {
      font-family: 'Courier New', monospace;
      font-size: 0.8rem;
      color: #3b82f6;
      word-break: break-all;
      background: rgba(0, 0, 0, 0.3);
      padding: 8px;
      border-radius: 4px;
      margin-top: 8px;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    /* Animated background particles */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 80%, rgba(30, 64, 175, 0.25) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(59, 130, 246, 0.25) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(147, 197, 253, 0.25) 0%, transparent 50%);
      z-index: -1;
    }

    .container {
      width: 100%;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
    }

    /* New live status style */
    #live-status {
      font-weight: 700;
      font-size: 1.3rem;
      margin-bottom: 12px;
      text-align: center;
      padding: 6px 12px;
      border-radius: 12px;
      display: inline-block;
      min-width: 120px;
      user-select: none;
      transition: background-color 0.3s ease;
    }
    #live-status.live {
      background-color: #16a34a; /* green */
      color: #d1fae5;
      box-shadow: 0 0 15px #22c55e;
    }
    #live-status.offline {
      background-color: #9ca3af; /* gray */
      color: #f3f4f6;
      box-shadow: none;
    }

    h1 {
      color: #ffffff;
      margin-bottom: 40px;
      font-size: 3rem;
      font-weight: 800;
      text-align: center;
      text-shadow: 0 4px 20px rgba(0,0,0,0.3);
      background: linear-gradient(45deg, #ffffff, #e0e7ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.02em;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
    }

    .help-btn {
      background: rgba(59, 130, 246, 0.2);
      border: 2px solid rgba(59, 130, 246, 0.5);
      color: #3b82f6;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      font-size: 1.8rem;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      text-shadow: none;
      -webkit-text-fill-color: initial;
      background-clip: initial;
      -webkit-background-clip: initial;
    }

    .help-btn:hover {
      background: rgba(59, 130, 246, 0.3);
      border-color: #3b82f6;
      transform: scale(1.1);
      box-shadow: 0 0 20px rgba(59, 130, 246, 0.4);
    }

    .trophy-icon {
      display: inline-block;
      width: 60px;
      height: 60px;
      margin-right: 15px;
      vertical-align: middle;
      animation: trophyBounce 2s ease-in-out infinite;
      filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.8));
    }

    @keyframes trophyBounce {
      0%, 100% { 
        transform: translateY(0px) scale(1);
        filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.8));
      }
      50% { 
        transform: translateY(-8px) scale(1.05);
        filter: drop-shadow(0 0 25px rgba(255, 215, 0, 1));
      }
    }

    h1::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 4px;
      background: linear-gradient(90deg, transparent, #ffffff, transparent);
      border-radius: 2px;
    }

    .leaderboard-card {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 20px 40px rgba(0,0,0,0.3);
      overflow: hidden;
      position: relative;
    }

    .leaderboard-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
    }

    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background: transparent;
    }

    th {
      background: rgba(255, 255, 255, 0.08);
      color: #ffffff;
      font-weight: 700;
      text-transform: uppercase;
      font-size: 1.1rem;
      letter-spacing: 1px;
      padding: 20px 15px;
      text-align: left;
      position: relative;
      backdrop-filter: blur(10px);
    }

    tbody tr {
      background: rgba(255, 255, 255, 0.02);
      transition: all 0.3s ease;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      position: relative;
    }

    tbody tr:hover {
      background: rgba(255, 255, 255, 0.08);
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }

    td {
      color: #ffffff;
      font-weight: 500;
      padding: 18px 15px;
      position: relative;
      font-size: 1.1rem;
    }

    .rank {
      font-weight: 800;
      font-size: 1.4rem;
      text-align: center;
      width: 80px;
    }

    .rank-1 {
      background: linear-gradient(45deg, #ffd700, #ffed4e);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .rank-2 {
      background: linear-gradient(45deg, #c0c0c0, #e5e5e5);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .rank-3 {
      background: linear-gradient(45deg, #cd7f32, #daa520);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .username {
      font-weight: 600;
      font-size: 1.2rem;
      transition: all 0.3s ease;
    }

    .username:hover {
      color: #e0e7ff;
      text-shadow: 0 0 10px rgba(224, 231, 255, 0.5);
    }

    .message-count {
      font-weight: 600;
      color: #e0e7ff;
      text-align: center;
      font-size: 1.1rem;
    }

    .prize {
      font-weight: 700;
      font-size: 1.2rem;
      text-align: center;
      min-width: 80px;
    }

    .prize-1 { color: #ffd700; }
    .prize-2 { color: #c0c0c0; }
    .prize-3 { color: #cd7f32; }
    .prize-4, .prize-5 { color: #e0e7ff; }

    /* Loading animation */
    .loading {
      text-align: center;
      padding: 40px;
      color: rgba(255, 255, 255, 0.8);
    }

    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: #ffffff;
      animation: spin 1s ease-in-out infinite;
      margin-right: 10px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .container {
        padding: 10px;
      }
      
      h1 {
        font-size: 2rem;
        margin-bottom: 30px;
      }
      
      th, td {
        padding: 12px 8px;
        font-size: 0.9rem;
      }
      
      .rank {
        width: 60px;
        font-size: 1rem;
      }
      
      .prize {
        min-width: 60px;
        font-size: 0.9rem;
      }

      .timer-container {
        top: 80px;
        right: 10px;
        padding: 10px 15px;
        min-width: 150px;
      }

      .timer-title {
        font-size: 0.8rem;
      }

      .timer-display {
        font-size: 1rem;
      }

      .roll-container {
        top: 80px;
        left: 10px;
        padding: 15px;
        min-width: 200px;
        max-width: 250px;
      }

      .roll-title {
        font-size: 1rem;
        margin-bottom: 10px;
      }

      .roll-timer {
        font-size: 1.1rem;
        padding: 8px;
        margin-bottom: 10px;
      }

      .roll-winner {
        padding: 12px;
        margin-bottom: 8px;
      }

      .roll-winner-name {
        font-size: 1.1rem;
      }

      .roll-winner-prize {
        font-size: 1rem;
      }
    }

    @media (max-width: 480px) {
      body {
        padding: 0;
      }
      
      h1 {
        font-size: 1.5rem;
      }
      
      th, td {
        padding: 8px 4px;
        font-size: 0.8rem;
      }
      
      .rank {
        width: 40px;
        font-size: 0.9rem;
      }
      
      .prize {
        min-width: 50px;
        font-size: 0.8rem;
      }

      .timer-container {
        top: 75px;
        right: 5px;
        padding: 8px 12px;
        min-width: 120px;
      }

      .timer-title {
        font-size: 0.7rem;
        margin-bottom: 5px;
      }

      .timer-display {
        font-size: 0.9rem;
      }

      .previous-leaderboard-btn {
        padding: 6px 12px;
        font-size: 0.7rem;
        margin-top: 8px;
      }

      .roll-container {
        top: 75px;
        left: 5px;
        padding: 10px;
        min-width: 150px;
        max-width: 200px;
      }

      .roll-title {
        font-size: 0.9rem;
        margin-bottom: 8px;
      }

      .roll-timer {
        font-size: 1rem;
        padding: 6px;
        margin-bottom: 8px;
      }

      .roll-winner {
        padding: 10px;
        margin-bottom: 6px;
      }

      .roll-winner-title {
        font-size: 0.8rem;
        margin-bottom: 6px;
      }

      .roll-winner-name {
        font-size: 1rem;
        margin-bottom: 4px;
      }

      .roll-winner-prize {
        font-size: 0.9rem;
      }

      .roll-hash {
        font-size: 0.6rem;
        padding: 6px;
        margin-top: 8px;
      }

      .verification-btn {
        width: 18px;
        height: 18px;
        font-size: 11px;
        top: 6px;
        right: 6px;
      }

      .modal-content {
        padding: 15px;
        max-width: 98%;
      }

      .modal-title {
        font-size: 1.2rem;
      }

      .section-title {
        font-size: 1rem;
      }

      .verification-input {
        padding: 8px;
        font-size: 0.75rem;
      }

      .verify-btn {
        padding: 8px 16px;
        font-size: 0.8rem;
      }

      .result-item {
        font-size: 0.8rem;
      }

      .seed-display {
        font-size: 0.7rem;
        padding: 6px;
      }
    }

    .top-widgets {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: flex-start;
      gap: 20px;
      width: 100%;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }
    .timer-container, .roll-container {
      position: static;
      min-width: 220px;
      margin: 0;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    }
    .table-scroll {
      width: 100%;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    table {
      min-width: 480px;
    }
    @media (max-width: 900px) {
      .top-widgets {
        flex-direction: column;
        align-items: stretch;
        gap: 12px;
      }
      .timer-container, .roll-container {
        min-width: unset;
        width: 100%;
      }
    }
    @media (max-width: 768px) {
      .top-widgets {
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
        margin-bottom: 16px;
      }
      .timer-container, .roll-container {
        width: 100%;
        min-width: unset;
        margin: 0 auto;
      }
      .table-scroll {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
      table {
        min-width: 420px;
      }
    }
    @media (max-width: 480px) {
      .top-widgets {
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
        margin-bottom: 10px;
      }
      .timer-container, .roll-container {
        width: 100%;
        min-width: unset;
        margin: 0 auto;
        padding: 6px 4px;
      }
      .table-scroll {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
      table {
        min-width: 350px;
      }
    }
    .top-widgets-mobile {
      display: none;
    }
    .timer-desktop, .roll-desktop {
      display: block;
    }
    .timer-mobile, .roll-mobile {
      display: none;
    }
    @media (max-width: 768px) {
      .top-widgets-mobile {
        display: flex;
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
        margin-bottom: 16px;
        width: 100%;
      }
      .timer-mobile, .roll-mobile {
        display: block;
        position: static;
        width: 100%;
        min-width: unset;
        margin: 0 auto;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      }
      .timer-desktop, .roll-desktop {
        display: none;
      }
      
      .navbar {
        height: 60px;
      }
      
      .nav-tab {
        padding: 10px 20px;
        font-size: 0.9rem;
        min-width: 120px;
      }
      
      .content-section {
        padding-top: 80px;
      }
    }
    
    @media (max-width: 480px) {
      .navbar {
        height: 55px;
      }
      
      .nav-tab {
        padding: 8px 16px;
        font-size: 0.8rem;
        min-width: 100px;
      }
      
      .content-section {
        padding-top: 30px;
      }

      .previous-leaderboard-modal-content {
        padding: 15px;
        max-width: 98%;
      }

      .previous-leaderboard-modal-title {
        font-size: 1.2rem;
      }

      .previous-leaderboard-table th,
      .previous-leaderboard-table td {
        padding: 8px 6px;
        font-size: 0.8rem;
      }

      .previous-leaderboard-table .rank {
        width: 40px;
        font-size: 1rem;
      }

      .previous-leaderboard-table .prize {
        min-width: 50px;
        font-size: 0.9rem;
      }
    }

    @media (min-width: 769px) {
      .table-scroll {
        overflow-x: visible;
        -webkit-overflow-scrolling: auto;
      }
    }
    
    /* Keep .timer-container and .roll-container fixed for desktop as before */
    .timer-desktop {
      position: fixed;
      top: 90px;
      right: 20px;
      z-index: 1000;
    }
    .roll-desktop {
      position: fixed;
      top: 90px;
      left: 20px;
      z-index: 1000;
    }

    /* Password modal styles */
    .password-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
      z-index: 3000;
      display: none;
      align-items: center;
      justify-content: center;
    }

    .password-modal-content {
      background: rgba(30, 41, 59, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 30px;
      max-width: 400px;
      width: 90%;
      position: relative;
    }

    .password-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .password-modal-title {
      font-size: 1.3rem;
      font-weight: 700;
      color: #ffffff;
    }

    .password-modal-close {
      background: none;
      border: none;
      color: #9ca3af;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 5px;
      border-radius: 5px;
      transition: all 0.3s ease;
    }

    .password-modal-close:hover {
      color: #ffffff;
      background: rgba(255, 255, 255, 0.1);
    }

    .password-input {
      width: 100%;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      padding: 12px;
      color: #ffffff;
      font-size: 1rem;
      margin-bottom: 20px;
    }

    .password-input:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
    }

    .roll-btn {
      background: linear-gradient(45deg, #10b981, #059669);
      border: none;
      border-radius: 8px;
      padding: 12px 24px;
      color: #ffffff;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
      font-size: 1rem;
    }

    .roll-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
    }

    .roll-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* Winner animation modal styles */
    .winner-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(10px);
      z-index: 4000;
      display: none;
      align-items: flex-start;
      justify-content: center;
      overflow: visible !important;
    }

    .winner-modal-content {
      background: rgba(30, 41, 59, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 40px;
      max-width: 800px;
      width: 90%;
      text-align: center;
      position: relative;
      overflow: visible !important;
      margin-top: 250px;
    }

    .winner-animation {
      margin: 40px 0 30px 0;
      min-height: 120px;
      position: relative;
      overflow-x: hidden;
      overflow-y: visible;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 15px;
      border: 2px solid rgba(255, 255, 255, 0.1);
    }

    .center-indicator {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      height: 100%;
      width: 0;
      border-left: 4px solid #ffd700;
      z-index: 10;
      pointer-events: none;
      display: block;
      box-sizing: border-box;
    }
    .center-indicator::before {
      content: '';
    }

    .slider-track {
      display: flex;
      transition: transform 0.1s ease;
      position: relative;
    }

    .slider-slot {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 15px 20px;
      margin: 10px 5px;
      min-width: 150px;
      text-align: center;
      transition: all 0.3s ease;
      opacity: 0.6;
      position: relative;
    }

    .slider-slot.active {
      background: rgba(16, 185, 129, 0.2);
      border-color: #10b981;
      opacity: 1;
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(16, 185, 129, 0.4);
    }

    .slider-slot.winner {
      background: linear-gradient(45deg, #ffd700, #ffed4e);
      border-color: #ffd700;
      opacity: 1;
      transform: scale(1.1);
      box-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
      animation: winnerPulse 1s infinite;
    }

    .slider-slot-name {
      font-weight: 700;
      font-size: 1.1rem;
      color: #ffffff;
      margin-bottom: 5px;
    }

    .slider-slot.winner .slider-slot-name {
      color: #000000;
    }

    .slider-slot-rank {
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.7);
    }

    .slider-slot.winner .slider-slot-rank {
      color: #000000;
    }

    .winner-result {
      margin-top: 30px;
      padding: 20px;
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: 15px;
    }

    .winner-result-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #10b981;
      margin-bottom: 10px;
    }

    .winner-result-name {
      font-size: 2rem;
      font-weight: 800;
      color: #ffffff;
      margin-bottom: 10px;
    }

    .winner-result-prize {
      font-size: 1.3rem;
      font-weight: 600;
      color: #ffd700;
    }

    @keyframes winnerPulse {
      0%, 100% { 
        transform: scale(1.1);
        box-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
      }
      50% { 
        transform: scale(1.15);
        box-shadow: 0 0 40px rgba(255, 215, 0, 1);
      }
    }

    .roll-winner-btn {
      background: linear-gradient(45deg, #3b82f6, #1d4ed8);
      border: none;
      border-radius: 10px;
      padding: 12px 24px;
      color: #ffffff;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1rem;
      width: 100%;
      margin-top: 15px;
    }

    .roll-winner-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
    }

    .roll-winner-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* Previous leaderboard modal styles */
    .previous-leaderboard-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
      z-index: 3000;
      display: none;
      align-items: center;
      justify-content: center;
    }

    .previous-leaderboard-modal-content {
      background: rgba(30, 41, 59, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 30px;
      max-width: 800px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
    }

    .previous-leaderboard-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .previous-leaderboard-modal-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #ffffff;
    }

    .previous-leaderboard-modal-close {
      background: none;
      border: none;
      color: #9ca3af;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 5px;
      border-radius: 5px;
      transition: all 0.3s ease;
    }

    .previous-leaderboard-modal-close:hover {
      color: #ffffff;
      background: rgba(255, 255, 255, 0.1);
    }

    .previous-leaderboard-info {
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      text-align: center;
    }

    .previous-leaderboard-date {
      font-size: 1.1rem;
      font-weight: 600;
      color: #3b82f6;
      margin-bottom: 5px;
    }

    .previous-leaderboard-week {
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.8);
    }

    .previous-leaderboard-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background: transparent;
    }

    .previous-leaderboard-table th {
      background: rgba(255, 255, 255, 0.08);
      color: #ffffff;
      font-weight: 700;
      text-transform: uppercase;
      font-size: 1rem;
      letter-spacing: 1px;
      padding: 15px 12px;
      text-align: left;
      position: relative;
      backdrop-filter: blur(10px);
    }

    .previous-leaderboard-table tbody tr {
      background: rgba(255, 255, 255, 0.02);
      transition: all 0.3s ease;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      position: relative;
    }

    .previous-leaderboard-table tbody tr:hover {
      background: rgba(255, 255, 255, 0.08);
      transform: translateY(-1px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .previous-leaderboard-table td {
      color: #ffffff;
      font-weight: 500;
      padding: 12px;
      position: relative;
      font-size: 1rem;
    }

    .previous-leaderboard-table .rank {
      font-weight: 800;
      font-size: 1.2rem;
      text-align: center;
      width: 60px;
    }

    .previous-leaderboard-table .rank-1 {
      background: linear-gradient(45deg, #ffd700, #ffed4e);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .previous-leaderboard-table .rank-2 {
      background: linear-gradient(45deg, #c0c0c0, #e5e5e5);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .previous-leaderboard-table .rank-3 {
      background: linear-gradient(45deg, #cd7f32, #daa520);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .previous-leaderboard-table .username {
      font-weight: 600;
      font-size: 1.1rem;
      transition: all 0.3s ease;
    }

    .previous-leaderboard-table .username:hover {
      color: #e0e7ff;
      text-shadow: 0 0 10px rgba(224, 231, 255, 0.5);
    }

    .previous-leaderboard-table .message-count {
      font-weight: 600;
      color: #e0e7ff;
      text-align: center;
      font-size: 1rem;
    }

    .previous-leaderboard-table .prize {
      font-weight: 700;
      font-size: 1.1rem;
      text-align: center;
      min-width: 70px;
    }

    .previous-leaderboard-table .prize-1 { color: #ffd700; }
    .previous-leaderboard-table .prize-2 { color: #c0c0c0; }
    .previous-leaderboard-table .prize-3 { color: #cd7f32; }
    .previous-leaderboard-table .prize-4, .previous-leaderboard-table .prize-5 { color: #e0e7ff; }

    .no-previous-leaderboard {
      text-align: center;
      padding: 40px;
      color: rgba(255, 255, 255, 0.8);
      font-size: 1.1rem;
    }

    .roll-container.roll-desktop {
      min-height: 220px;
      padding-top: 32px;
      padding-bottom: 32px;
    }
    .roll-container.roll-desktop .roll-winner {
      margin-top: 18px;
    }
    #roll-winner-desktop {
      display: block !important;
    }

    /* Rewards layout styles */
    .rewards-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 100px;
      margin-bottom: 20px;
      padding: 0;
      max-width: 1600px;
      margin-left: auto;
      margin-right: auto;
    }

    .rewards-grid .leaderboard-card:first-child,
    .rewards-grid .leaderboard-card:nth-child(2) {
      min-height: 400px;
      max-height: 550px;
    }

    .rewards-grid .leaderboard-card:first-child {
      margin-left: -300px;
      min-width: 650px;
      width: 100%;
      position: relative;
      left: 100px;
    }

    .rewards-grid .leaderboard-card:nth-child(2) {
      margin-right: -200px;
      min-width: 650px;
      width: 100%;
      justify-self: end;
      position: relative;
      right: -00px;
    }

    .rewards-grid .leaderboard-card:last-child {
      grid-column: 1 / -1;
      max-width: 600px;
      margin: 0 auto;
      margin-top: -20px;
    }

    @media (max-width: 768px) {
      .rewards-grid {
        grid-template-columns: 1fr;
        gap: 15px;
        padding: 0;
        max-width: none;
      }
      
      .rewards-grid .leaderboard-card:first-child,
      .rewards-grid .leaderboard-card:nth-child(2) {
        min-height: auto;
        max-height: none;
        min-width: auto;
        margin-left: 0;
        margin-right: 0;
        justify-self: stretch;
        width: auto;
        position: static;
        left: auto;
        right: auto;
      }
      
      .rewards-grid .leaderboard-card:first-child {
        margin-left: 10px;
        /* transform: translateX(-30px); */
      }
      
      .rewards-grid .leaderboard-card:last-child {
        grid-column: 1;
        max-width: none;
      }
    }

    .gift-icon {
      display: inline-block;
      width: 85px;
      height: 85px;
      margin-right: 5px;
      vertical-align: middle;
      animation: trophyBounce 2s ease-in-out infinite;
      filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.8));
    }

    /* Highlight animation for help button */
    @keyframes highlightGlow {
      0% {
        box-shadow: 0 20px 40px rgba(0,0,0,0.3);
      }
      50% {
        box-shadow: 0 20px 40px rgba(0,0,0,0.3), 0 0 30px rgba(59, 130, 246, 0.8), 0 0 60px rgba(59, 130, 246, 0.4);
        border-color: rgba(59, 130, 246, 0.6);
      }
      100% {
        box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        border-color: rgba(255, 255, 255, 0.1);
      }
    }

    .highlight-animation {
      animation: highlightGlow 2s ease-in-out;
    }

    /* Custom scrollbar styles */
    ::-webkit-scrollbar {
      width: 12px !important;
    }

    ::-webkit-scrollbar-track {
      background: #000000 !important;
      border-radius: 6px !important;
    }

    ::-webkit-scrollbar-thumb {
      background: #3b82f6 !important;
      border-radius: 6px !important;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #1d4ed8 !important;
    }

    /* Firefox scrollbar */
    * {
      scrollbar-width: thin !important;
      scrollbar-color: #3b82f6 #000000 !important;
    }

    /* Ensure scrollbars are visible on all scrollable elements */
    html, body, .content-section, .container, .leaderboard-card, .rewards-grid {
      scrollbar-width: thin !important;
      scrollbar-color: #3b82f6 #000000 !important;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar">
    <div class="nav-container">
      <button class="nav-tab active" onclick="showSection('chat-leaderboard')">Chat Leaderboard</button>
      <button class="nav-tab" onclick="showSection('rewards')">Other Rewards</button>
    </div>
  </nav>

  <!-- Chat Leaderboard Section -->
  <div id="chat-leaderboard" class="content-section active">
    <div class="container">
      <h1><img src="trophy.png" alt="Trophy" class="trophy-icon">Kick Chat Leaderboard<button class="help-btn" onclick="goToRewardsHelp()">?</button></h1>
      <!-- Mobile widgets below h1 -->
      <div class="top-widgets-mobile">
        <div class="timer-container timer-mobile">
          <div class="timer-title">Next Reset</div>
          <div class="timer-display" id="timer">Loading...</div>
          <button class="previous-leaderboard-btn" onclick="openPreviousLeaderboardModal()">📊 Previous Leaderboard</button>
        </div>
        <div class="roll-container roll-mobile">
          <div class="roll-title">🎲 Weekly Roll</div>
          <button class="roll-winner-btn" onclick="openPasswordModal()">Roll Winner</button>
          <div id="roll-winner" style="display: none;">
            <div class="roll-winner">
              <div class="roll-winner-title">Latest Winner</div>
              <div class="roll-winner-name" id="winner-name">-</div>
              <div class="roll-winner-prize" id="winner-prize">-</div>
            </div>
          </div>
        </div>
      </div>
      <!-- Desktop fixed widgets -->
      <div class="timer-container timer-desktop">
        <div class="timer-title">Next Reset</div>
        <div class="timer-display" id="timer-desktop">Loading...</div>
        <button class="previous-leaderboard-btn" onclick="openPreviousLeaderboardModal()">📊 Previous Leaderboard</button>
      </div>
      <div class="roll-container roll-desktop">
        <div class="roll-title">🎲 Weekly Roll</div>
        <button class="roll-winner-btn" onclick="openPasswordModal()">Roll Winner</button>
        <div id="roll-winner-desktop" style="display: none;">
          <div class="roll-winner">
            <div class="roll-winner-title">Latest Winner</div>
            <div class="roll-winner-name" id="winner-name-desktop">-</div>
            <div class="roll-winner-prize" id="winner-prize-desktop">-</div>
          </div>
        </div>
      </div>

      <div class="leaderboard-card">
        <div class="table-scroll">
          <table id="leaderboard">
            <thead>
              <tr>
                <th>Rank</th>
                <th>Username</th>
                <th>Messages</th>
                <th>Prize</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="4" class="loading">
                  <div class="spinner"></div>
                  Loading leaderboard...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Rewards Section -->
  <div id="rewards" class="content-section">
    <div class="container">
      <h1 style="margin-top: 30px;"><img src="gift.png" alt="Gift" class="gift-icon">Rewards</h1>
      <div class="rewards-grid" style="margin-bottom: 10px;">
        <div class="leaderboard-card">
          <div style="padding: 20px;">
            <h2 style="color: #e0e7ff; margin-bottom: 15px; font-size: 1.4rem;">Dice Tournament Overview</h2>
            <div style="color: rgba(255, 255, 255, 0.9); font-size: 0.95rem; line-height: 1.5;">
              <p><strong>Game:</strong> Dice</p>
              <p><strong>Target Multiplier:</strong> 99x (1% win chance)</p>
              <p><strong>Bets Per Player:</strong> 100</p>
              <p><strong>Max Players:</strong> 8 or 16 total entries (based on stream viewership and profit)</p>
              
              <h3 style="color: #10b981; margin: 15px 0 8px 0; font-size: 1.1rem;">Start Conditions:</h3>
              <p>Tournament starts if stream balance reaches $1600+ early</p>
              <p>Or $1200+ after 1 hour and 30 minutes of stream time</p>
              
              <h3 style="color: #10b981; margin: 15px 0 8px 0; font-size: 1.1rem;">Win Condition:</h3>
              <p>Each player will place 100 bets at the 99x multiplier. The faster player to hit a 99x wins their round. If no one hits, the players will do a coinflip to decide who moves on</p>
              
              <h3 style="color: #10b981; margin: 15px 0 8px 0; font-size: 1.1rem;">How to Enter:</h3>
              <p>Spots open during the stream. Viewers can join live once entries are announced. Entry is limited and based on activity, so be ready. no activity during the tournaments will result in a loss of prize / reroll.</p>
              
              <h3 style="color: #10b981; margin: 15px 0 8px 0; font-size: 1.1rem;">Prizes:</h3>
              <p style="color: #ffd700; font-weight: 600;">$5-20</p>
            </div>
          </div>
        </div>
        
        <div class="leaderboard-card">
          <div style="padding: 20px;">
            <h2 style="color: #e0e7ff; margin-bottom: 15px; font-size: 1.4rem;">Ending Balance Giveaways</h2>
            <div style="color: rgba(255, 255, 255, 0.9); font-size: 0.95rem; line-height: 1.5;">
              <p>At the end of each stream, if the final balance is between $2,700 and $3,000+, a giveaway is triggered.</p>
              
              <h3 style="color: #10b981; margin: 15px 0 8px 0; font-size: 1.1rem;">How it works:</h3>
              <p>A prize wheel is rolled live on stream. The reward is determined by where the wheel lands. Prizes range from $20 to $100, varying by luck and wheel outcome.</p>
              
              <h3 style="color: #10b981; margin: 15px 0 8px 0; font-size: 1.1rem;">Eligibility:</h3>
              <p>Giveaway details, including how to enter or qualify, are announced during the stream. Stay active and tuned in until the end to participate.</p>
            </div>
          </div>
        </div>
        
        <div class="leaderboard-card">
          <div style="padding: 30px;">
            <h2 style="color: #e0e7ff; margin-bottom: 20px; font-size: 1.5rem;">Chat Leaderboard</h2>
            <div style="color: rgba(255, 255, 255, 0.9); font-size: 1rem; line-height: 1.6;">
              <p>Each week, the top 5 most active chatters will win a share of a $25 prize pool.</p>
              
              <p>In addition, one extra lucky chatter from the top 10 will be randomly selected to win an extra $10 bonus.</p>
              
              <h3 style="color: #10b981; margin: 20px 0 10px 0; font-size: 1.2rem;">Anti-Spam Notice:</h3>
              <p>Spamming does not increase your chances. Activity is tracked with spam protection in place — only genuine chat participation counts.</p>
              
              <p style="color: #ffd700; font-weight: 600; margin-top: 15px;">Leaderboard resets weekly. Stay active, engage, and climb the ranks.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Password Modal -->
  <div id="passwordModal" class="password-modal-overlay">
    <div class="password-modal-content">
      <div class="password-modal-header">
        <h3 class="password-modal-title">Admin Access Required</h3>
        <button class="password-modal-close" onclick="closePasswordModal()">&times;</button>
      </div>
      <input type="password" id="passwordInput" class="password-input" placeholder="Enter password" onkeypress="handlePasswordKeyPress(event)">
      <button class="roll-btn" onclick="verifyPassword()">Roll Winner</button>
    </div>
  </div>

  <!-- Winner Animation Modal -->
  <div id="winnerModal" class="winner-modal-overlay">
    <div class="winner-modal-content">
      <h2 style="color: #ffffff; margin-bottom: 20px; font-size: 1.8rem;">🎲 Rolling Winner...</h2>
      <div class="winner-animation" id="winnerAnimation">
        <div class="center-indicator"></div>
        <div class="slider-track" id="sliderTrack">
          <!-- Slider slots will be populated here -->
        </div>
      </div>
      <div class="winner-result" id="winnerResult" style="display: none;">
        <div class="winner-result-title">🎉 Winner Selected!</div>
        <div class="winner-result-name" id="finalWinnerName">-</div>
        <div class="winner-result-prize" id="finalWinnerPrize">-</div>
      </div>
    </div>
  </div>

  <!-- Previous Leaderboard Modal -->
  <div id="previousLeaderboardModal" class="previous-leaderboard-modal-overlay">
    <div class="previous-leaderboard-modal-content">
      <div class="previous-leaderboard-modal-header">
        <h3 class="previous-leaderboard-modal-title">📊 Previous Leaderboard</h3>
        <button class="previous-leaderboard-modal-close" onclick="closePreviousLeaderboardModal()">&times;</button>
      </div>
      <div class="previous-leaderboard-info" id="previousLeaderboardInfo" style="display: none;">
        <div class="previous-leaderboard-date" id="previousLeaderboardDate">-</div>
        <div class="previous-leaderboard-week" id="previousLeaderboardWeek">-</div>
      </div>
      <div id="previousLeaderboardContent">
        <div class="no-previous-leaderboard">
          <div class="spinner"></div>
          Loading previous leaderboard...
        </div>
      </div>
    </div>
  </div>

  <script>
    let lastLeaderboard = [];
    function isSameLeaderboard(a, b) {
      if (a.length !== b.length) return false;
      for (let i = 0; i < a.length; i++) {
        if (a[i].username !== b[i].username || a[i].messageCount !== b[i].messageCount) {
          return false;
        }
      }
      return true;
    }

    // Timer functions
    async function updateTimer() {
      try {
        const res = await fetch("/timer");
        const data = await res.json();
        const timerEls = [
          document.getElementById("timer"),
          document.getElementById("timer-desktop")
        ].filter(Boolean);
        timerEls.forEach(timerEl => {
          if (data.timeLeft <= 0) {
            timerEl.textContent = "RESETTING...";
            timerEl.className = "timer-display timer-critical";
            return;
          }
          const days = data.days;
          const hours = data.hours.toString().padStart(2, '0');
          const minutes = data.minutes.toString().padStart(2, '0');
          const seconds = data.seconds.toString().padStart(2, '0');
          timerEl.textContent = `${days}d ${hours}:${minutes}:${seconds}`;
          timerEl.className = "timer-display";
          if (days === 0 && data.hours < 1) {
            timerEl.classList.add("timer-critical");
          } else if (days === 0 && data.hours < 6) {
            timerEl.classList.add("timer-warning");
          }
        });
      } catch (e) {
        [document.getElementById("timer"), document.getElementById("timer-desktop")].forEach(timerEl => {
          if (timerEl) timerEl.textContent = "Error";
        });
      }
    }

    // Roll system functions
    async function updateRollSystem() {
      try {
        const res = await fetch("/roll-info");
        const data = await res.json();
        const rollTimerEls = [
          document.getElementById("roll-timer"),
          document.getElementById("roll-timer-desktop")
        ].filter(Boolean);
        const rollWinnerEls = [
          document.getElementById("roll-winner"),
          document.getElementById("roll-winner-desktop")
        ].filter(Boolean);
        const winnerNameEls = [
          document.getElementById("winner-name"),
          document.getElementById("winner-name-desktop")
        ].filter(Boolean);
        const winnerPrizeEls = [
          document.getElementById("winner-prize"),
          document.getElementById("winner-prize-desktop")
        ].filter(Boolean);
        // Update roll timer (same as leaderboard timer)
        let timerText = "Rolling...";
        if (data.timeUntilRoll > 0) {
          const days = Math.floor(data.timeUntilRoll / (1000 * 60 * 60 * 24));
          const hours = Math.floor((data.timeUntilRoll % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
          const minutes = Math.floor((data.timeUntilRoll % (1000 * 60 * 60)) / (1000 * 60));
          const seconds = Math.floor((data.timeUntilRoll % (1000 * 60)) / 1000);
          timerText = days > 0
            ? `Next Roll: ${days}d ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`
            : `Next Roll: ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        rollTimerEls.forEach(el => el.textContent = timerText);
        // Show latest winner if available (stays until next roll)
        if (data.latestRoll) {
          winnerNameEls.forEach(el => el.textContent = data.latestRoll.winner);
          winnerPrizeEls.forEach(el => el.textContent = `$${data.latestRoll.prize.toFixed(2)}`);
          rollWinnerEls.forEach(el => el.style.display = "block");
        } else {
          rollWinnerEls.forEach(el => el.style.display = "none");
        }
      } catch (e) {
        [document.getElementById("roll-timer"), document.getElementById("roll-timer-desktop")].forEach(el => {
          if (el) el.textContent = "Error";
        });
      }
    }

    // Verification modal functions
    async function openVerificationModal() {
      const modal = document.getElementById("verificationModal");
      modal.style.display = "flex";
      
      // Load current server seed
      try {
        const res = await fetch("/current-seed");
        const data = await res.json();
        document.getElementById("currentSeed").textContent = data.serverSeed;
      } catch (e) {
        document.getElementById("currentSeed").textContent = "Error loading seed";
      }
    }

    function closeVerificationModal() {
      const modal = document.getElementById("verificationModal");
      modal.style.display = "none";
      document.getElementById("verificationResult").style.display = "none";
    }

    async function verifyRoll() {
      const serverSeed = document.getElementById("serverSeedInput").value.trim();
      const clientSeed = document.getElementById("clientSeedInput").value.trim();
      const nonce = document.getElementById("nonceInput").value.trim();
      
      if (!serverSeed || !clientSeed || !nonce) {
        alert("Please fill in all fields");
        return;
      }
      
      try {
        const res = await fetch(`/verify-roll?serverSeed=${encodeURIComponent(serverSeed)}&clientSeed=${encodeURIComponent(clientSeed)}&nonce=${encodeURIComponent(nonce)}`);
        const data = await res.json();
        
        if (data.error) {
          alert("Error: " + data.error);
          return;
        }
        
        // Display results
        document.getElementById("combinedResult").textContent = data.combined;
        document.getElementById("hashResult").textContent = data.hash;
        document.getElementById("rollResult").textContent = data.rollResult.toFixed(8);
        document.getElementById("verificationResult").style.display = "block";
        
      } catch (e) {
        alert("Error verifying roll: " + e.message);
      }
    }

    // Close modal when clicking outside
    document.addEventListener('click', function(event) {
      const modal = document.getElementById("verificationModal");
      if (event.target === modal) {
        closeVerificationModal();
      }
    });

    async function loadLeaderboard() {
      try {
        const res = await fetch("/leaderboard");
        const data = await res.json();
        if (isSameLeaderboard(data, lastLeaderboard)) return; // No change, do nothing
        lastLeaderboard = data;
        const tbody = document.querySelector("#leaderboard tbody");
        // Only animate if this is the first load, otherwise just update
        const isFirstLoad = tbody.children.length === 1 && tbody.children[0].querySelector('.loading');
        tbody.innerHTML = "";

        // Updated prize distribution for top 5 ranks (total $25)
        const prizes = [8, 6, 5, 3, 3];
        data.forEach((entry, index) => {
          const row = document.createElement("tr");
          if (isFirstLoad) {
            row.style.animation = `fadeInRow 0.6s ${index * 0.08}s both`;
          }
          const prize = index < prizes.length ? `$${prizes[index].toFixed(2)}` : "";
          row.innerHTML = `
            <td class="rank rank-${index + 1}">${index + 1}</td>
            <td class="username">${entry.username}</td>
            <td class="message-count">${entry.messageCount}</td>
            <td class="prize prize-${index + 1}">${prize}</td>
          `;
          tbody.appendChild(row);
        });
      } catch (e) {
        console.error("Failed to load leaderboard:", e);
      }
    }

    // Live status fetch and update function
    async function updateLiveStatus() {
      try {
        const res = await fetch("/live-status");
        if (!res.ok) throw new Error("Network response not OK");
        const data = await res.json();
        const statusEl = document.getElementById("live-status");
        if (data.isLive) {
          statusEl.textContent = "Live Now!";
          statusEl.classList.remove("offline");
          statusEl.classList.add("live");
        } else {
          statusEl.textContent = "Offline";
          statusEl.classList.remove("live");
          statusEl.classList.add("offline");
        }
      } catch (e) {
        const statusEl = document.getElementById("live-status");
        statusEl.textContent = "Status unavailable";
        statusEl.classList.remove("live");
        statusEl.classList.add("offline");
        console.error("Failed to fetch live status:", e);
      }
    }

    // Navigation function
    function showSection(sectionId) {
      // Hide all sections
      document.querySelectorAll('.content-section').forEach(section => {
        section.classList.remove('active');
      });
      
      // Remove active class from all nav tabs
      document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Show selected section
      document.getElementById(sectionId).classList.add('active');
      
      // Add active class to clicked tab
      event.target.classList.add('active');
      
      // Scroll to top of the page
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Help button function
    function goToRewardsHelp() {
      // Switch to rewards tab
      showSection('rewards');
      
      // Update nav tab active state
      document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelector('.nav-tab[onclick="showSection(\'rewards\')"]').classList.add('active');
      
      // Scroll to the third box after a short delay
      setTimeout(() => {
        const thirdBox = document.querySelector('.rewards-grid .leaderboard-card:last-child');
        if (thirdBox) {
          thirdBox.scrollIntoView({ behavior: 'smooth', block: 'center' });
          
          // Add highlight animation
          thirdBox.classList.add('highlight-animation');
          
          // Remove the animation class after it completes
          setTimeout(() => {
            thirdBox.classList.remove('highlight-animation');
          }, 2000);
        }
      }, 100);
    }

    // Test save leaderboard function
    async function testSaveLeaderboard() {
      try {
        const response = await fetch('/test-save-leaderboard', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        
        const result = await response.json();
        
        if (result.success) {
          alert(`✅ Test save successful!\n\n${result.message}\n\nTop 10 entries saved:\n${result.entries.map((entry, index) => `${index + 1}. ${entry.username} - ${entry.messageCount} messages`).join('\n')}`);
        } else {
          alert(`❌ Test save failed: ${result.message}`);
        }
      } catch (error) {
        console.error('Error during test save:', error);
        alert('❌ Error during test save: ' + error.message);
      }
    }

    // Password modal functions
    function openPasswordModal() {
      document.getElementById('passwordModal').style.display = 'flex';
      document.getElementById('passwordInput').focus();
    }

    function closePasswordModal() {
      document.getElementById('passwordModal').style.display = 'none';
      document.getElementById('passwordInput').value = '';
    }

    function handlePasswordKeyPress(event) {
      if (event.key === 'Enter') {
        verifyPassword();
      }
    }

    async function verifyPassword() {
      const password = document.getElementById('passwordInput').value;
      
      try {
        const response = await fetch('/verify-password', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ password })
        });
        
        const data = await response.json();
        
        if (data.success) {
          closePasswordModal();
          startWinnerAnimation();
        } else {
          alert('Incorrect password!');
          document.getElementById('passwordInput').value = '';
          document.getElementById('passwordInput').focus();
        }
      } catch (error) {
        console.error('Error verifying password:', error);
        alert('Error verifying password. Please try again.');
      }
    }

    // Winner animation functions
    async function startWinnerAnimation() {
      try {
        // Get current leaderboard data
        const res = await fetch("/leaderboard");
        let top10 = res.ok ? await res.json() : [];
        top10 = top10.slice(0, 10);
        if (top10.length === 0) {
          alert('No users in leaderboard to roll from!');
          return;
        }

        // Shuffle top10 users for this roll
        for (let i = top10.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [top10[i], top10[j]] = [top10[j], top10[i]];
        }

        // Show winner modal
        document.getElementById('winnerModal').style.display = 'flex';
        document.getElementById('winnerResult').style.display = 'none';
        
        // Create slider slots
        const sliderTrack = document.getElementById('sliderTrack');
        sliderTrack.innerHTML = '';
        const repeats = 50; // enough repeats
        let extendedUsers = [];
        for (let r = 0; r < repeats; r++) {
          extendedUsers = extendedUsers.concat(top10);
        }
        extendedUsers.forEach((user, index) => {
          const slot = document.createElement('div');
          slot.className = 'slider-slot';
          slot.innerHTML = `
            <div class=\"slider-slot-name\">${user.username}</div>
            <div class=\"slider-slot-rank\">Rank #${user.rank !== undefined ? user.rank : ((index)%top10.length)+1}</div>
          `;
          sliderTrack.appendChild(slot);
        });

        // Wait for DOM to render
        await new Promise(r => setTimeout(r, 50));
        
        // Get slot width dynamically
        const slotEl = sliderTrack.querySelector('.slider-slot');
        const slotWidth = slotEl ? slotEl.offsetWidth : 160;
        const centerOffset = (sliderTrack.parentElement.offsetWidth / 2) - (slotWidth / 2);
        
        // Start from position 0
        sliderTrack.style.transform = `translateX(${centerOffset}px)`;
        
        // Pick a random winner from the middle section
        const middleStart = Math.floor(extendedUsers.length * 0.4);
        const middleEnd = Math.floor(extendedUsers.length * 0.6);
        const winnerSlotIndex = Math.floor(Math.random() * (middleEnd - middleStart + 1)) + middleStart;
        const finalPosition = -(winnerSlotIndex * slotWidth);

        // Simple animation: move right to left smoothly
        await simpleSlideAnimation(sliderTrack, centerOffset, finalPosition, 15000);
        
        // After animation, pick the slot under the gold line
        pickWinnerFromDOM(extendedUsers, top10);
      } catch (e) {
        console.error('Error starting winner animation:', e);
        alert('Error starting winner selection!');
      }
    }

    function simpleSlideAnimation(sliderTrack, centerOffset, finalPosition, duration) {
      return new Promise(resolve => {
        const startTime = performance.now();
        const startPos = 0;
        const distance = finalPosition - startPos;
        
        function animate(currentTime) {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);
          
          // Ease out cubic for smooth deceleration
          const eased = 1 - Math.pow(1 - progress, 3);
          const currentPos = startPos + (distance * eased);
          
          sliderTrack.style.transform = `translateX(${centerOffset + currentPos}px)`;
          
          if (progress < 1) {
            requestAnimationFrame(animate);
          } else {
            resolve();
          }
        }
        
        requestAnimationFrame(animate);
      });
    }

    function pickWinnerFromDOM(extendedUsers, top10) {
      const sliderTrack = document.getElementById('sliderTrack');
      const slots = sliderTrack.querySelectorAll('.slider-slot');
      
      // Remove any existing highlights
      slots.forEach(slot => slot.classList.remove('winner'));
      
      // Find the center of the animation container
      const animationContainer = sliderTrack.parentElement;
      const containerRect = animationContainer.getBoundingClientRect();
      const centerX = containerRect.left + containerRect.width / 2;
      
      // Find the slot whose center is closest to the gold line
      let closestSlot = null;
      let minDistance = Infinity;
      
      slots.forEach((slot, index) => {
        const slotRect = slot.getBoundingClientRect();
        const slotCenterX = slotRect.left + slotRect.width / 2;
        const distance = Math.abs(slotCenterX - centerX);
        
        if (distance < minDistance) {
          minDistance = distance;
          closestSlot = { slot, index };
        }
      });
      
      // Highlight the winner slot
      if (closestSlot) {
        closestSlot.slot.classList.add('winner');
        const winnerUser = extendedUsers[closestSlot.index];
        
        // Save winner to DB
        fetch('/roll-winner', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            winner: winnerUser.username,
            prize: 10,
            timestamp: new Date().toISOString()
          })
        }).then(() => updateRollSystem());
        
        // Show winner result
        setTimeout(() => {
          document.getElementById('winnerResult').style.display = 'block';
          document.getElementById('winnerResult').innerHTML = `
            <div class='winner-result-title'>🏆 Winner!</div>
            <div class='winner-result-name'>${winnerUser.username}</div>
            <div class='winner-result-prize'>Win Amount: $10.00</div>
          `;
        }, 600);
      }
    }

    // Previous leaderboard modal functions
    async function openPreviousLeaderboardModal() {
      document.getElementById('previousLeaderboardModal').style.display = 'flex';
      await loadPreviousLeaderboard();
    }

    function closePreviousLeaderboardModal() {
      document.getElementById('previousLeaderboardModal').style.display = 'none';
    }

    async function loadPreviousLeaderboard() {
      try {
        const res = await fetch("/previous-leaderboard");
        const data = await res.json();
        
        const contentDiv = document.getElementById('previousLeaderboardContent');
        const infoDiv = document.getElementById('previousLeaderboardInfo');
        const dateDiv = document.getElementById('previousLeaderboardDate');
        const weekDiv = document.getElementById('previousLeaderboardWeek');
        
        if (!data.entries || data.entries.length === 0) {
          contentDiv.innerHTML = '<div class="no-previous-leaderboard">No previous leaderboard found</div>';
          infoDiv.style.display = 'none';
          return;
        }
        
        // Show info section
        infoDiv.style.display = 'block';
        
        // Format and display date
        if (data.resetDate) {
          const resetDate = new Date(data.resetDate);
          dateDiv.textContent = resetDate.toLocaleDateString('en-US', { 
            weekday: 'long', 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
          });
        }
        
        // Display week number
        if (data.weekNumber) {
          weekDiv.textContent = `Week ${data.weekNumber}`;
        }
        
        // Create table
        const prizes = [8, 6, 5, 3, 3]; // Same prize distribution as current leaderboard
        let tableHTML = `
          <table class="previous-leaderboard-table">
            <thead>
              <tr>
                <th>Rank</th>
                <th>Username</th>
                <th>Messages</th>
                <th>Prize</th>
              </tr>
            </thead>
            <tbody>
        `;
        
        data.entries.forEach((entry, index) => {
          const prize = index < prizes.length ? `$${prizes[index].toFixed(2)}` : "";
          tableHTML += `
            <tr>
              <td class="rank rank-${index + 1}">${entry.rank}</td>
              <td class="username">${entry.username}</td>
              <td class="message-count">${entry.messageCount}</td>
              <td class="prize prize-${index + 1}">${prize}</td>
            </tr>
          `;
        });
        
        tableHTML += '</tbody></table>';
        contentDiv.innerHTML = tableHTML;
        
      } catch (e) {
        console.error("Failed to load previous leaderboard:", e);
        document.getElementById('previousLeaderboardContent').innerHTML = 
          '<div class="no-previous-leaderboard">Error loading previous leaderboard</div>';
      }
    }

    // Close modals when clicking outside
    document.addEventListener('click', function(event) {
      const passwordModal = document.getElementById("passwordModal");
      const winnerModal = document.getElementById("winnerModal");
      const previousLeaderboardModal = document.getElementById("previousLeaderboardModal");
      
      if (event.target === passwordModal) {
        closePasswordModal();
      }
      if (event.target === winnerModal) {
        document.getElementById('winnerModal').style.display = 'none';
      }
      if (event.target === previousLeaderboardModal) {
        closePreviousLeaderboardModal();
      }
    });

    // Close winner modal with escape key
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        document.getElementById('winnerModal').style.display = 'none';
        closePasswordModal();
      }
    });

    // Initial load and set intervals
    loadLeaderboard();
    updateLiveStatus();
    updateTimer();
    updateRollSystem();
    setInterval(loadLeaderboard, 1500);    // refresh leaderboard every 1.5s
    setInterval(updateLiveStatus, 1000);   // refresh live status every 1s
    setInterval(updateTimer, 1000);        // refresh timer every 1s
    setInterval(updateRollSystem, 5000);   // refresh roll system every 5s
  </script>

  <style>
    @keyframes fadeInRow {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</body>
</html>
